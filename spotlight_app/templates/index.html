<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  >
  <title>Spotlight</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

  <div id="app-shell">
    <!-- HEADER -->
    <header class="app-topbar">
      <div class="user-avatar" onclick="goToSettings()" title="{{ user.username }}">
        <img src="{{ user.avatar_url }}" alt="{{ user.username }}">
      </div>

      <div class="trust-score-pill">
        <i class="fas fa-shield-halved"></i>
        <span id="my-trust-score">--</span>
      </div>

      <div class="spacer"></div>

      <button class="text-btn" onclick="fetchMyFeedback()">My Feedback</button>
      <button class="text-btn" onclick="reportApp()">Report App</button>

      <div class="bell-wrapper">
        <div class="bell-icon" id="bellIcon" onclick="toggleBellBox()">
          <i class="fas fa-bell"></i>
          <span id="bell-dot" class="bell-dot hidden"></span>
        </div>
        <div class="bell-box hidden" id="bellBox"></div>
      </div>
    </header>

    <!-- =========================
         MAP
    ========================== -->
    <div id="map"></div>

    <!-- Nearby carousel -->
    <div id="nearby-carousel" class="nearby-carousel"></div>

    <!-- =========================
         LIVE STATUS PILL
    ========================== -->
    <div id="live-indicator" class="live-status hidden">
      <div class="pulsing-dot"></div>
      <span>You are Live (5 km)</span>
      <button onclick="turnOffSpotlight()" class="text-btn">OFF</button>
    </div>

    <!-- =========================
         FLOATING ACTION BUTTON
    ========================== -->
    <div class="fab-container" id="main-fab">
      <button class="glow-btn" onclick="openSheet('checkin-sheet')">
        <i class="fas fa-location-dot"></i>
        Check In
      </button>
    </div>

    <!-- =========================
         OVERLAY
    ========================== -->
    <div id="overlay" class="overlay hidden" onclick="closeAllSheets()"></div>

    <!-- =========================
         CHECK‑IN SHEET
    ========================== -->
    <div id="checkin-sheet" class="bottom-sheet">
      <div class="sheet-handle"></div>

      <div class="sheet-body">
        <h2>Go Spotlight</h2>
        <p class="subtitle">Visible within 5 km</p>

        <div class="input-group">
          <input id="place" placeholder="Where are you? (Starbucks, Library)">
        </div>

        <div class="input-group">
          <input id="intent" placeholder="Why are you here? (Coffee, Study)">
        </div>

        <div class="input-group">
          <input id="meet_time" type="time">
        </div>

        <div class="input-group">
          <select id="bill">
            <option value="split">Split Bill</option>
            <option value="self">Pay Individually</option>
            <option value="host">I Will Pay</option>
          </select>
        </div>

        <div class="input-group">
          <input id="visual-clue" placeholder="Visual clue (e.g. red jacket)">
        </div>

        <div class="action-row">
          <button class="secondary-btn" onclick="closeAllSheets()">Cancel</button>
          <button class="primary-btn" onclick="confirmCheckIn()">Go Live</button>
        </div>
      </div>
    </div>

    <!-- =========================
         PROFILE SHEET
    ========================== -->
    <div id="profile-sheet" class="bottom-sheet">
      <div class="sheet-handle"></div>

      <div class="profile-header">
        <div class="avatar-ring" id="p-avatar">
          <i class="fas fa-user"></i>
        </div>

        <div class="profile-meta">
          <h2 id="p-username">Username</h2>
          <div class="trust-badge">
            <i class="fas fa-star"></i>
            <span id="p-score">--</span> Trust
          </div>
        </div>
      </div>

      <div class="sheet-body">
        <p id="p-place"></p>
        <p id="p-intent"></p>
        <p id="p-time"></p>
        <p id="p-distance"></p>
        <div id="p-clue-wrap" class="hidden">
          <div class="visual-clue" id="p-clue"></div>
        </div>
        <div id="p-bio-wrap" class="hidden">
          <div class="profile-bio" id="p-bio"></div>
        </div>
        <div id="p-vibes-wrap" class="hidden profile-vibes"></div>

        <div class="action-row">
          <button class="secondary-btn" onclick="closeAllSheets()">Cancel</button>
          <button class="primary-btn" onclick="sendRequest()">
            <i class="fas fa-paper-plane"></i>
            Request to Join
          </button>
          <button class="secondary-btn" onclick="reportUser()">Report</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       MATCH VIEW (hidden)
  ========================== -->
  <div id="match-view" class="match-overlay hidden">
    <div class="match-card">
      <h2>You're in match mode</h2>
      <p>Have a great date!</p>
      <div class="match-actions" style="justify-content:center;">
        <button class="primary-btn" onclick="endMatch()">End Match</button>
      </div>
    </div>
  </div>

  <!-- =========================
       FEEDBACK VIEW (hidden)
   ========================== -->
  <div id="feedback-view" class="hidden feedback-view">
    <div class="feedback-card">
      <h2>⭐ Rate Your Match ⭐</h2>
      <p id="feedback-username"></p>
      <div id="rating-box"></div>
      <textarea id="feedback-text"
        placeholder="Write up to 50 words"
        style="width:90%;max-width:400px;height:80px;"></textarea>
      <div class="action-row">
        <button onclick="submitFeedback()" class="primary-btn">Submit</button>
        <button onclick="backToMap()" class="secondary-btn">Back</button>
      </div>
    </div>
  </div>

  <!-- =========================
       SCRIPTS
  ========================== -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>
